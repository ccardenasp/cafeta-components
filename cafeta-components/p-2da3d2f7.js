import{E as t,G as i,H as e,J as s,V as a,B as n,L as o,F as r,K as g,w as h,N as M,D as x,C as c,s as d,P as u,O as l,Q as T,S as m,y as I,U as p,R as w,n as D,M as L,X as C,Y as b,I as A}from"./p-dd9bf309.js";var F=/\s/,H=/^\s+/;var Y=/^[-+]0x[0-9a-f]+$/i,f=/^0b[01]+$/i,y=/^0o[0-7]+$/i,j=parseInt;function S(s){if("number"==typeof s)return s;if(function(e){return"symbol"==typeof e||t(e)&&"[object Symbol]"==i(e)}(s))return NaN;if(e(s)){var a="function"==typeof s.valueOf?s.valueOf():s;s=e(a)?a+"":a}if("string"!=typeof s)return 0===s?s:+s;var n;s=(n=s)?n.slice(0,function(t){for(var i=t.length;i--&&F.test(t.charAt(i)););return i}(n)+1).replace(H,""):n;var o=f.test(s);return o||y.test(s)?j(s.slice(2),o?2:8):Y.test(s)?NaN:+s}var z=function(){return s.Date.now()},N=Math.max,v=Math.min;
/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
class E extends a{constructor(t){super(t);const i=this.bindTemplate;this.set("isVisible",!1),this.set("position","se"),this.children=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-reset","ck-dropdown__panel",i.to("position",t=>"ck-dropdown__panel_"+t),i.if("isVisible","ck-dropdown__panel-visible")]},children:this.children,on:{selectstart:i.to(t=>t.preventDefault())}})}focus(){this.children.length&&this.children.first.focus()}focusLast(){if(this.children.length){const t=this.children.last;"function"==typeof t.focusLast?t.focusLast():t.focus()}}}
/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
class W extends n{constructor(t){super(t),this.arrowView=this._createArrowView(),this.extendTemplate({attributes:{"aria-haspopup":!0}}),this.delegate("execute").to(this,"open")}render(){super.render(),this.children.add(this.arrowView)}_createArrowView(){const t=new o;return t.content="data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMTAgMTAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTS45NDEgNC41MjNhLjc1Ljc1IDAgMSAxIDEuMDYtMS4wNmwzLjAwNiAzLjAwNSAzLjAwNS0zLjAwNWEuNzUuNzUgMCAxIDEgMS4wNiAxLjA2bC0zLjU0OSAzLjU1YS43NS43NSAwIDAgMS0xLjE2OC0uMTM2TC45NDEgNC41MjN6Ii8+PC9zdmc+",t.extendTemplate({attributes:{class:"ck-dropdown__arrow"}}),t}}
/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class X extends a{constructor(){super(),this.items=this.createCollection(),this.focusTracker=new r,this.keystrokes=new g,this._focusCycler=new h({focusables:this.items,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"arrowup",focusNext:"arrowdown"}}),this.setTemplate({tag:"ul",attributes:{class:["ck","ck-reset","ck-list"]},children:this.items})}render(){super.render();for(const t of this.items)this.focusTracker.add(t.element);this.items.on("add",(t,i)=>{this.focusTracker.add(i.element)}),this.items.on("remove",(t,i)=>{this.focusTracker.remove(i.element)}),this.keystrokes.listenTo(this.element)}focus(){this._focusCycler.focusFirst()}focusLast(){this._focusCycler.focusLast()}}
/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class _ extends a{constructor(t){super(t),this.children=this.createCollection(),this.setTemplate({tag:"li",attributes:{class:["ck","ck-list__item"]},children:this.children})}focus(){this.children.first.focus()}}
/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class k extends a{constructor(t){super(t),this.setTemplate({tag:"li",attributes:{class:["ck","ck-list__separator"]}})}}
/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class V extends n{constructor(t){super(t),this.isToggleable=!0,this.toggleSwitchView=this._createToggleView(),this.extendTemplate({attributes:{class:"ck-switchbutton"}})}render(){super.render(),this.children.add(this.toggleSwitchView)}_createToggleView(){const t=new a;return t.setTemplate({tag:"span",attributes:{class:["ck","ck-button__toggle"]},children:[{tag:"span",attributes:{class:["ck","ck-button__toggle__inner"]}}]}),t}}
/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
class O extends c{refresh(){const t=this.editor.model.document.selection.getSelectedElement();this.isEnabled=d(t),this.value=t&&t.hasAttribute("width")?{width:t.getAttribute("width"),height:null}:null}execute(t){const i=this.editor.model,e=i.document.selection.getSelectedElement();this.value={width:t.width,height:null},e&&i.change(i=>{i.setAttribute("width",t.width,e)})}}
/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class J extends u{static get pluginName(){return"ImageResizeEditing"}constructor(t){super(t),t.config.define("image",{resizeUnit:"%",resizeOptions:[{name:"imageResize:original",value:null,icon:"original"},{name:"imageResize:25",value:"25",icon:"small"},{name:"imageResize:50",value:"50",icon:"medium"},{name:"imageResize:75",value:"75",icon:"large"}]})}init(){const t=this.editor,i=new O(t);this._registerSchema(),this._registerConverters(),t.commands.add("imageResize",i)}_registerSchema(){this.editor.model.schema.extend("image",{allowAttributes:"width"}),this.editor.model.schema.setAttributeProperties("width",{isFormatting:!0})}_registerConverters(){const t=this.editor;t.conversion.for("downcast").add(t=>t.on("attribute:width:image",(t,i,e)=>{if(!e.consumable.consume(i.item,t.name))return;const s=e.writer,a=e.mapper.toViewElement(i.item);null!==i.attributeNewValue?(s.setStyle("width",i.attributeNewValue,a),s.addClass("image_resized",a)):(s.removeStyle("width",a),s.removeClass("image_resized",a))})),t.conversion.for("upcast").attributeToAttribute({view:{name:"figure",styles:{width:/.+/}},model:{key:"width",value:t=>t.getStyle("width")}})}}
/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class B{constructor(t,i){i&&l(this,i),t&&this.set(t)}}T(B,m);const R="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMCAyMCI+PHBhdGggZD0iTTIuNSAxN3YxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6TTEgMTUuNXYxSDB2LTFoMXptMTkgMHYxaC0xdi0xaDF6bS0xOS0ydjFIMHYtMWgxem0xOSAwdjFoLTF2LTFoMXptLTE5LTJ2MUgwdi0xaDF6bTE5IDB2MWgtMXYtMWgxem0tMTktMnYxSDB2LTFoMXptMTkgMHYxaC0xdi0xaDF6bS0xOS0ydjFIMHYtMWgxem0xOSAwdjFoLTF2LTFoMXptLTE5LTJ2MUgwdi0xaDF6bTE5IDB2MWgtMXYtMWgxem0wLTJ2MWgtMXYtMWgxem0tMTkgMHYxSDB2LTFoMXpNMTQuNSAydjFoLTFWMmgxem0yIDB2MWgtMVYyaDF6bTIgMHYxaC0xVjJoMXptLTggMHYxaC0xVjJoMXptLTIgMHYxaC0xVjJoMXptLTIgMHYxaC0xVjJoMXptLTIgMHYxaC0xVjJoMXptOCAwdjFoLTFWMmgxem0tMTAgMHYxaC0xVjJoMXoiLz48cGF0aCBkPSJNMTAgOEgyYTIgMiAwIDAgMC0yIDJ2NmEyIDIgMCAwIDAgMiAyaDhhMiAyIDAgMCAwIDItMnYtNmEyIDIgMCAwIDAtMi0yem0wIDEuNWEuNS41IDAgMCAxIC41LjV2NmEuNS41IDAgMCAxLS41LjVIMmEuNS41IDAgMCAxLS41LS41di02YS41LjUgMCAwIDEgLjUtLjVoOHoiLz48L3N2Zz4=",U={small:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMCAyMCI+PHBhdGggZD0iTTIuNSAxN3YxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6TTEgMTUuNXYxSDB2LTFoMXptMTkgMHYxaC0xdi0xaDF6bS0xOS0ydjFIMHYtMWgxem0xOSAwdjFoLTF2LTFoMXptLTE5LTJ2MUgwdi0xaDF6bTE5IDB2MWgtMXYtMWgxem0tMTktMnYxSDB2LTFoMXptMTkgMHYxaC0xdi0xaDF6bS0xOS0ydjFIMHYtMWgxem0xOSAwdjFoLTF2LTFoMXptLTE5LTJ2MUgwdi0xaDF6bTE5IDB2MWgtMXYtMWgxem0wLTJ2MWgtMXYtMWgxem0tMTkgMHYxSDB2LTFoMXpNMTQuNSAydjFoLTFWMmgxem0yIDB2MWgtMVYyaDF6bTIgMHYxaC0xVjJoMXptLTggMHYxaC0xVjJoMXptLTIgMHYxaC0xVjJoMXptLTIgMHYxaC0xVjJoMXptLTIgMHYxaC0xVjJoMXptOCAwdjFoLTFWMmgxem0tMTAgMHYxaC0xVjJoMXoiLz48cGF0aCBkPSJNNyAxMEgyYTIgMiAwIDAgMC0yIDJ2NGEyIDIgMCAwIDAgMiAyaDVhMiAyIDAgMCAwIDItMnYtNGEyIDIgMCAwIDAtMi0yem0wIDEuNWEuNS41IDAgMCAxIC41LjV2NGEuNS41IDAgMCAxLS41LjVIMmEuNS41IDAgMCAxLS41LS41di00YS41LjUgMCAwIDEgLjUtLjVoNXoiLz48L3N2Zz4=",medium:R,large:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMCAyMCI+PHBhdGggZD0iTTIuNSAxN3YxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6TTEgMTUuNXYxSDB2LTFoMXptMTkgMHYxaC0xdi0xaDF6bS0xOS0ydjFIMHYtMWgxem0xOSAwdjFoLTF2LTFoMXptLTE5LTJ2MUgwdi0xaDF6bTE5IDB2MWgtMXYtMWgxem0tMTktMnYxSDB2LTFoMXptMTkgMHYxaC0xdi0xaDF6bS0xOS0ydjFIMHYtMWgxem0xOSAwdjFoLTF2LTFoMXptLTE5LTJ2MUgwdi0xaDF6bTE5IDB2MWgtMXYtMWgxem0wLTJ2MWgtMXYtMWgxem0tMTkgMHYxSDB2LTFoMXpNMTQuNSAydjFoLTFWMmgxem0yIDB2MWgtMVYyaDF6bTIgMHYxaC0xVjJoMXptLTggMHYxaC0xVjJoMXptLTIgMHYxaC0xVjJoMXptLTIgMHYxaC0xVjJoMXptLTIgMHYxaC0xVjJoMXptOCAwdjFoLTFWMmgxem0tMTAgMHYxaC0xVjJoMXoiLz48cGF0aCBkPSJNMTMgNkgyYTIgMiAwIDAgMC0yIDJ2OGEyIDIgMCAwIDAgMiAyaDExYTIgMiAwIDAgMCAyLTJWOGEyIDIgMCAwIDAtMi0yem0wIDEuNWEuNS41IDAgMCAxIC41LjV2OGEuNS41IDAgMCAxLS41LjVIMmEuNS41IDAgMCAxLS41LS41VjhhLjUuNSAwIDAgMSAuNS0uNWgxMXoiLz48L3N2Zz4=",original:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyMCAyMCI+PHBhdGggZD0iTTIuNSAxN3YxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6bTIgMHYxaC0xdi0xaDF6TTEgMTUuNXYxSDB2LTFoMXptMTkgMHYxaC0xdi0xaDF6bS0xOS0ydjFIMHYtMWgxem0xOSAwdjFoLTF2LTFoMXptLTE5LTJ2MUgwdi0xaDF6bTE5IDB2MWgtMXYtMWgxem0tMTktMnYxSDB2LTFoMXptMTkgMHYxaC0xdi0xaDF6bS0xOS0ydjFIMHYtMWgxem0xOSAwdjFoLTF2LTFoMXptLTE5LTJ2MUgwdi0xaDF6bTE5IDB2MWgtMXYtMWgxem0wLTJ2MWgtMXYtMWgxem0tMTkgMHYxSDB2LTFoMXpNMTQuNSAydjFoLTFWMmgxem0yIDB2MWgtMVYyaDF6bTIgMHYxaC0xVjJoMXptLTggMHYxaC0xVjJoMXptLTIgMHYxaC0xVjJoMXptLTIgMHYxaC0xVjJoMXptLTIgMHYxaC0xVjJoMXptOCAwdjFoLTFWMmgxem0tMTAgMHYxaC0xVjJoMXoiLz48cGF0aCBkPSJNMTguMDk1IDJIMS45MDVDLjg1MyAyIDAgMi44OTUgMCA0djEyYzAgMS4xMDUuODUzIDIgMS45MDUgMmgxNi4xOUMxOS4xNDcgMTggMjAgMTcuMTA1IDIwIDE2VjRjMC0xLjEwNS0uODUzLTItMS45MDUtMnptMCAxLjVjLjI2MyAwIC40NzYuMjI0LjQ3Ni41djEyYzAgLjI3Ni0uMjEzLjUtLjQ3Ni41SDEuOTA1YS40ODkuNDg5IDAgMCAxLS40NzYtLjVWNGMwLS4yNzYuMjEzLS41LjQ3Ni0uNWgxNi4xOXoiLz48L3N2Zz4="};class P extends u{static get requires(){return[J]}static get pluginName(){return"ImageResizeButtons"}constructor(t){super(t),this._resizeUnit=t.config.get("image.resizeUnit")}init(){const t=this.editor,i=t.config.get("image.resizeOptions"),e=t.commands.get("imageResize");this.bind("isEnabled").to(e);for(const s of i)this._registerImageResizeButton(s);this._registerImageResizeDropdown(i)}_registerImageResizeButton(t){const i=this.editor,{name:e,value:s,icon:a}=t,o=s?s+this._resizeUnit:null;i.ui.componentFactory.add(e,e=>{const s=new n(e),r=i.commands.get("imageResize"),g=this._getOptionLabelValue(t,!0);if(!U[a])throw new I("imageresizebuttons-missing-icon",i,t);return s.set({label:g,icon:U[a],tooltip:g,isToggleable:!0}),s.bind("isEnabled").to(this),s.bind("isOn").to(r,"value",Z(o)),this.listenTo(s,"execute",()=>{i.execute("imageResize",{width:o})}),s})}_registerImageResizeDropdown(t){const i=this.editor,e=i.t,s=t.find(t=>!t.value);i.ui.componentFactory.add("imageResize",a=>{const o=i.commands.get("imageResize"),r=function(t,i=W){const e=new i(t),s=new E(t),a=new M(t,e,s);return e.bind("isEnabled").to(a),e instanceof W?e.bind("isOn").to(a,"isOpen"):e.arrowView.bind("isOn").to(a,"isOpen"),function(t){(function(t){t.on("render",()=>{x({emitter:t,activator:()=>t.isOpen,callback:()=>{t.isOpen=!1},contextElements:[t.element]})})})(t),function(t){t.on("execute",i=>{i.source instanceof V||(t.isOpen=!1)})}(t),function(t){t.keystrokes.set("arrowdown",(i,e)=>{t.isOpen&&(t.panelView.focus(),e())}),t.keystrokes.set("arrowup",(i,e)=>{t.isOpen&&(t.panelView.focusLast(),e())})}(t)}(a),a}(a,W),g=r.buttonView;return g.set({tooltip:e("Resize image"),commandValue:s.value,icon:R,isToggleable:!0,label:this._getOptionLabelValue(s),withText:!0,class:"ck-resize-image-button"}),g.bind("label").to(o,"value",t=>t&&t.width?t.width:this._getOptionLabelValue(s)),r.bind("isOn").to(o),r.bind("isEnabled").to(this),function(t,i){const e=t.locale,s=t.listView=new X(e);s.items.bindTo(i).using(({type:t,model:i})=>{if("separator"===t)return new k(e);if("button"===t||"switchbutton"===t){const s=new _(e);let a;return a="button"===t?new n(e):new V(e),a.bind(...Object.keys(i)).to(i),a.delegate("execute").to(s),s.children.add(a),s}}),t.panelView.children.add(s),s.items.delegate("execute").to(t)}(r,this._getResizeDropdownListItemDefinitions(t,o)),r.listView.ariaLabel=e("Image resize list"),this.listenTo(r,"execute",t=>{i.execute(t.source.commandName,{width:t.source.commandValue}),i.editing.view.focus()}),r})}_getOptionLabelValue(t,i){const e=this.editor.t;return t.label?t.label:i?t.value?e("Resize image to %0",t.value+this._resizeUnit):e("Resize image to the original size"):t.value?t.value+this._resizeUnit:e("Original")}_getResizeDropdownListItemDefinitions(t,i){const e=new p;return t.map(t=>{const s=t.value?t.value+this._resizeUnit:null,a={type:"button",model:new B({commandName:"imageResize",commandValue:s,label:this._getOptionLabelValue(t),withText:!0,icon:null})};a.model.bind("isOn").to(i,"value",Z(s)),e.add(a)}),e}}function Z(t){return i=>null===t&&i===t||i&&i.width===t}
/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
class G{constructor(t){this.set("activeHandlePosition",null),this.set("proposedWidthPercents",null),this.set("proposedWidth",null),this.set("proposedHeight",null),this.set("proposedHandleHostWidth",null),this.set("proposedHandleHostHeight",null),this._options=t,this._referenceCoordinates=null}begin(t,i,e){const s=new w(i);this.activeHandlePosition=function(t){const i=["top-left","top-right","bottom-right","bottom-left"];for(const e of i)if(t.classList.contains("ck-widget__resizer__handle-"+e))return e}(t),this._referenceCoordinates=function(t,i){const e=new w(t),s=i.split("-"),a={x:"right"==s[1]?e.right:e.left,y:"bottom"==s[0]?e.bottom:e.top};return a.x+=t.ownerDocument.defaultView.scrollX,a.y+=t.ownerDocument.defaultView.scrollY,a}(i,function(t){const i=t.split("-"),e={top:"bottom",bottom:"top",left:"right",right:"left"};return`${e[i[0]]}-${e[i[1]]}`}
/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */(this.activeHandlePosition)),this.originalWidth=s.width,this.originalHeight=s.height,this.aspectRatio=s.width/s.height;const a=e.style.width;this.originalWidthPercents=a&&a.match(/^\d+\.?\d*%$/)?parseFloat(a):function(t,i){const e=t.parentElement,s=parseFloat(e.ownerDocument.defaultView.getComputedStyle(e).width);return i.width/s*100}(e,s)}update(t){this.proposedWidth=t.width,this.proposedHeight=t.height,this.proposedWidthPercents=t.widthPercents,this.proposedHandleHostWidth=t.handleHostWidth,this.proposedHandleHostHeight=t.handleHostHeight}}T(G,m);class Q{constructor(t){this._options=t,this._domResizerWrapper=null,this._viewResizerWrapper=null,this.set("isEnabled",!0),this.decorate("begin"),this.decorate("cancel"),this.decorate("commit"),this.decorate("updateSize"),this.on("commit",t=>{this.state.proposedWidth||this.state.proposedWidthPercents||(this._cleanup(),t.stop())},{priority:"high"}),this.on("change:isEnabled",()=>{this.isEnabled&&this.redraw()})}attach(){const t=this,i=this._options.viewElement;this._options.editor.editing.view.change(e=>{const s=e.createUIElement("div",{class:"ck ck-reset_all ck-widget__resizer"},(function(i){const e=this.toDomElement(i);return t._appendHandles(e),t._appendSizeUI(e),t._domResizerWrapper=e,t.on("change:isEnabled",(t,i,s)=>{e.style.display=s?"":"none"}),e.style.display=t.isEnabled?"":"none",e}));e.insert(e.createPositionAt(i,"end"),s),e.addClass("ck-widget_with-resizer",i),this._viewResizerWrapper=s})}begin(t){this.state=new G(this._options),this._sizeUI.bindToState(this._options,this.state),this._initialViewWidth=this._options.viewElement.getStyle("width"),this.state.begin(t,this._getHandleHost(),this._getResizeHost())}updateSize(t){const i=this._proposeNewSize(t);this._options.editor.editing.view.change(t=>{const e=this._options.unit||"%";t.setStyle("width",("%"===e?i.widthPercents:i.width)+e,this._options.viewElement)});const e=this._getHandleHost(),s=new w(e);i.handleHostWidth=Math.round(s.width),i.handleHostHeight=Math.round(s.height);const a=new w(e);i.width=Math.round(a.width),i.height=Math.round(a.height),this.redraw(s),this.state.update(i)}commit(){const t=this._options.unit||"%",i=("%"===t?this.state.proposedWidthPercents:this.state.proposedWidth)+t;this._options.editor.editing.view.change(()=>{this._cleanup(),this._options.onCommit(i)})}cancel(){this._cleanup()}destroy(){this.cancel()}redraw(t){const i=this._domResizerWrapper;if(!((e=i)&&e.ownerDocument&&e.ownerDocument.contains(e)))return;var e;
/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const s=i.parentElement,a=this._getHandleHost(),n=this._viewResizerWrapper,o=[n.getStyle("width"),n.getStyle("height"),n.getStyle("left"),n.getStyle("top")];let r;if(s.isSameNode(a)){const i=t||new w(a);r=[i.width+"px",i.height+"px",void 0,void 0]}else r=[a.offsetWidth+"px",a.offsetHeight+"px",a.offsetLeft+"px",a.offsetTop+"px"];"same"!==function(t,i){const e=Math.min(t.length,i.length);for(let s=0;s<e;s++)if(t[s]!=i[s])return s;return t.length==i.length?"same":t.length<i.length?"prefix":"extension"}(o,r)&&this._options.editor.editing.view.change(t=>{t.setStyle({width:r[0],height:r[1],left:r[2],top:r[3]},n)})}containsHandle(t){return this._domResizerWrapper.contains(t)}static isResizeHandle(t){return t.classList.contains("ck-widget__resizer__handle")}_cleanup(){this._sizeUI.dismiss(),this._sizeUI.isVisible=!1,this._options.editor.editing.view.change(t=>{t.setStyle("width",this._initialViewWidth,this._options.viewElement)})}_proposeNewSize(t){const i=this.state,e=(a=t).pageX,s=a.pageY;var a;const n=!this._options.isCentered||this._options.isCentered(this),o={x:i._referenceCoordinates.x-(e+i.originalWidth),y:s-i.originalHeight-i._referenceCoordinates.y};n&&i.activeHandlePosition.endsWith("-right")&&(o.x=e-(i._referenceCoordinates.x+i.originalWidth)),n&&(o.x*=2);const r={width:Math.abs(i.originalWidth+o.x),height:Math.abs(i.originalHeight+o.y)};r.dominant=r.width/i.aspectRatio>r.height?"width":"height",r.max=r[r.dominant];const g={width:r.width,height:r.height};return"width"==r.dominant?g.height=g.width/i.aspectRatio:g.width=g.height*i.aspectRatio,{width:Math.round(g.width),height:Math.round(g.height),widthPercents:Math.min(Math.round(i.originalWidthPercents/i.originalWidth*g.width*100)/100,100)}}_getResizeHost(){return this._options.getResizeHost(this._domResizerWrapper.parentElement)}_getHandleHost(){return this._options.getHandleHost(this._domResizerWrapper.parentElement)}_appendHandles(t){const i=["top-left","top-right","bottom-right","bottom-left"];for(const s of i)t.appendChild(new D({tag:"div",attributes:{class:"ck-widget__resizer__handle "+(e=s,"ck-widget__resizer__handle-"+e)}}).render());var e}_appendSizeUI(t){const i=new $;i.render(),this._sizeUI=i,t.appendChild(i.element)}}T(Q,m);class $ extends a{constructor(){super();const t=this.bindTemplate;this.setTemplate({tag:"div",attributes:{class:["ck","ck-size-view",t.to("activeHandlePosition",t=>t?"ck-orientation-"+t:"")],style:{display:t.if("isVisible","none",t=>!t)}},children:[{text:t.to("label")}]})}bindToState(t,i){this.bind("isVisible").to(i,"proposedWidth",i,"proposedHeight",(t,i)=>null!==t&&null!==i),this.bind("label").to(i,"proposedHandleHostWidth",i,"proposedHandleHostHeight",i,"proposedWidthPercents",(i,e,s)=>"px"===t.unit?`${i}×${e}`:s+"%"),this.bind("activeHandlePosition").to(i)}dismiss(){this.unbind(),this.isVisible=!1}}class q extends u{static get pluginName(){return"WidgetResize"}init(){this.set("visibleResizer",null),this.set("_activeResizer",null),this._resizers=new Map;const t=b.window.document;this.editor.model.schema.setAttributeProperties("width",{isFormatting:!0}),this.editor.editing.view.addObserver(L),this._observer=Object.create(C),this.listenTo(this.editor.editing.view.document,"mousedown",this._mouseDownListener.bind(this),{priority:"high"}),this._observer.listenTo(t,"mousemove",this._mouseMoveListener.bind(this)),this._observer.listenTo(t,"mouseup",this._mouseUpListener.bind(this));const i=()=>{this.visibleResizer&&this.visibleResizer.redraw()},s=function(t){var i=!0,s=!0;if("function"!=typeof t)throw new TypeError("Expected a function");return e(void 0)&&(i="leading"in void 0?!!(void 0).leading:i,s="trailing"in void 0?!!(void 0).trailing:s),function(t,i,s){var a,n,o,r,g,h,M=0,x=!1,c=!1,d=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function u(i){var e=a,s=n;return a=n=void 0,M=i,r=t.apply(s,e)}function l(t){return M=t,g=setTimeout(m,i),x?u(t):r}function T(t){var e=t-h;return void 0===h||e>=i||e<0||c&&t-M>=o}function m(){var t=z();if(T(t))return I(t);g=setTimeout(m,function(t){var e=i-(t-h);return c?v(e,o-(t-M)):e}(t))}function I(t){return g=void 0,d&&a?u(t):(a=n=void 0,r)}function p(){var t=z(),e=T(t);if(a=arguments,n=this,h=t,e){if(void 0===g)return l(h);if(c)return clearTimeout(g),g=setTimeout(m,i),u(h)}return void 0===g&&(g=setTimeout(m,i)),r}return i=S(i)||0,e(s)&&(x=!!s.leading,o=(c="maxWait"in s)?N(S(s.maxWait)||0,i):o,d="trailing"in s?!!s.trailing:d),p.cancel=function(){void 0!==g&&clearTimeout(g),M=0,a=h=n=g=void 0},p.flush=function(){return void 0===g?r:I(z())},p}(t,200,{leading:i,maxWait:200,trailing:s})}(i);this.on("change:visibleResizer",i),this.editor.ui.on("update",s),this._observer.listenTo(b.window,"resize",s);const a=this.editor.editing.view.document.selection;a.on("change",()=>{const t=a.getSelectedElement();this.visibleResizer=this.getResizerByViewElement(t)||null})}destroy(){this._observer.stopListening();for(const t of this._resizers.values())t.destroy()}attachTo(t){const i=new Q(t),e=this.editor.plugins;if(i.attach(),e.has("WidgetToolbarRepository")){const t=e.get("WidgetToolbarRepository");i.on("begin",()=>{t.forceDisabled("resize")},{priority:"lowest"}),i.on("cancel",()=>{t.clearForceDisabled("resize")},{priority:"highest"}),i.on("commit",()=>{t.clearForceDisabled("resize")},{priority:"highest"})}this._resizers.set(t.viewElement,i);const s=this.editor.editing.view.document.selection.getSelectedElement();return this.getResizerByViewElement(s)==i&&(this.visibleResizer=i),i}getResizerByViewElement(t){return this._resizers.get(t)}_getResizerByHandle(t){for(const i of this._resizers.values())if(i.containsHandle(t))return i}_mouseDownListener(t,i){const e=i.domTarget;Q.isResizeHandle(e)&&(this._activeResizer=this._getResizerByHandle(e),this._activeResizer&&(this._activeResizer.begin(e),t.stop(),i.preventDefault()))}_mouseMoveListener(t,i){this._activeResizer&&this._activeResizer.updateSize(i)}_mouseUpListener(){this._activeResizer&&(this._activeResizer.commit(),this._activeResizer=null)}}T(q,m);
/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */
class K extends u{static get requires(){return[q]}static get pluginName(){return"ImageResizeHandles"}init(){const t=this.editor.commands.get("imageResize");this.bind("isEnabled").to(t),this._setupResizerCreator()}_setupResizerCreator(){const t=this.editor,i=t.editing.view;i.addObserver(A),this.listenTo(i.document,"imageLoaded",(e,s)=>{if(!s.target.matches("figure.image.ck-widget > img, figure.image.ck-widget > a > img"))return;const a=t.editing.view.domConverter.domToView(s.target).findAncestor("figure");let n=this.editor.plugins.get(q).getResizerByViewElement(a);if(n)return void n.redraw();const o=t.editing.mapper.toModelElement(a);n=t.plugins.get(q).attachTo({unit:t.config.get("image.resizeUnit"),modelElement:o,viewElement:a,editor:t,getHandleHost:t=>t.querySelector("img"),getResizeHost:t=>t,isCentered(){const t=o.getAttribute("imageStyle");return!t||"full"==t||"alignCenter"==t},onCommit(i){t.execute("imageResize",{width:i})}}),n.on("updateSize",()=>{a.hasClass("image_resized")||i.change(t=>{t.addClass("image_resized",a)})}),n.bind("isEnabled").to(this)})}}
/**
 * @license Copyright (c) 2003-2021, CKSource - Frederico Knabben. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */export default class extends u{static get requires(){return[J,K,P]}static get pluginName(){return"ImageResize"}}